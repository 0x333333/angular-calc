angular.module("ez.calc",[]).directive("ezCalc",[function(){"use strict";return{restrict:"EA",scope:{data:"=ezCalc"},templateUrl:"calc.html",link:function($scope,element,attrs){$scope.data={result:0,func:" "};var keyMap=["0","1","2","3","4","5","6","7","8","9",".","รท","x","-","+","=","C","+/-","%"],state=0,checkState=function(){(2===state||3===state)&&($scope.data.result=0,$scope.data.func=" ",state=0)};$scope.press=function(e){if(console.log("Pressed:",e),e>=0&&9>=e?checkState():e>=11&&14>=e&&2===state&&($scope.data.func=$scope.data.result,state=1),16===e)$scope.data.func=" ",$scope.data.result=0,state=0;else if(17===e){if(0===state)return;$scope.data.result=-1*evaluate($scope.data.func),$scope.data.func=$scope.data.result}else 18===e?(0===$scope.data.result?$scope.data.result=evaluate($scope.data.func)/100:$scope.data.result/=100,$scope.data.func=100*$scope.data.result+keyMap[e]+keyMap[15],state=2):15===e?($scope.data.func.indexOf("=")===$scope.data.func.length-1&&($scope.data.func=$scope.data.func.replace("=","")),$scope.data.result=evaluate($scope.data.func),$scope.data.func+=keyMap[e],state=2):($scope.data.func+=keyMap[e],state=1)};var evaluate=function(expr){try{var input=(expr+"").replace("x","*").replace("รท","/").replace("=","").trim();return eval(input)}catch(e){state=3,alert(e),checkState(),$scope.$digest()}}}}}]);